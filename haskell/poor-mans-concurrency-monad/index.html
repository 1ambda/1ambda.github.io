<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.18-DEV" />
    <meta name="description" content="hugo content for 1ambda.github.io">
<meta name="author" content="1ambda">

    <link rel="shortcut icon" href="https://1ambda.github.io/images/favicon.png" type="image/x-icon" />

    
    <title>Poor Man&#39;s Concurrency Monad</title>
    <link href="https://1ambda.github.io/css/nucleus.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/hybrid.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/featherlight.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/horsey.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/theme.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/hugo-theme.css" rel="stylesheet">
    <script src="https://1ambda.github.io/js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link href="https://1ambda.github.io/css/theme-1ambda.css" rel="stylesheet">

  </head>
  <body class="" data-url="/haskell/poor-mans-concurrency-monad/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a href="https://1ambda.github.io/home" style="color: white; margin-top:10px;">
  <div> <i class="fa fa-github fa-4x"></i> </div>
</a>
<div style="margin-top:5px; font-size: 25px;">1ambda</div>

    </div>
    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/home/">
        <a href="https://1ambda.github.io/home/">
          <span>
            
              <b>HOME</b>
            
             
            
           </span>
        </a>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/infrastructure/">
        <a href="https://1ambda.github.io/infrastructure/">
          <span>
            
              <b>- </b>
            
             Infrastructure
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/infrastructure/container/kubernetes-intro/">
              <a href="https://1ambda.github.io/infrastructure/container/kubernetes-intro/">
                <span>Kubernetes: Intro     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/golang/">
        <a href="https://1ambda.github.io/golang/">
          <span>
            
              <b>- </b>
            
             Golang
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/golang/golang-tutorial/">
              <a href="https://1ambda.github.io/golang/golang-tutorial/">
                <span>Golang Tutorial     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/scala/">
        <a href="https://1ambda.github.io/scala/">
          <span>
            
              <b>-</b>
            
             Scala
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-1/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-1/">
                <span>Easy Scalaz 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-2/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-2/">
                <span>Easy Scalaz 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-3/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-3/">
                <span>Easy Scalaz 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-4/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-4/">
                <span>Easy Scalaz 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-5/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-5/">
                <span>Easy Scalaz 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-6/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-6/">
                <span>Easy Scalaz 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-1/">
              <a href="https://1ambda.github.io/scala/functional-programming-1/">
                <span>Functional Programming 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-2/">
              <a href="https://1ambda.github.io/scala/functional-programming-2/">
                <span>Functional Programming 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-3/">
              <a href="https://1ambda.github.io/scala/functional-programming-3/">
                <span>Functional Programming 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-4/">
              <a href="https://1ambda.github.io/scala/functional-programming-4/">
                <span>Functional Programming 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-5/">
              <a href="https://1ambda.github.io/scala/functional-programming-5/">
                <span>Functional Programming 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-6/">
              <a href="https://1ambda.github.io/scala/functional-programming-6/">
                <span>Functional Programming 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-7/">
              <a href="https://1ambda.github.io/scala/functional-programming-7/">
                <span>Functional Programming 7     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-1/">
              <a href="https://1ambda.github.io/scala/reactive-programming-1/">
                <span>Reactive Programming 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-2/">
              <a href="https://1ambda.github.io/scala/reactive-programming-2/">
                <span>Reactive Programming 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-3/">
              <a href="https://1ambda.github.io/scala/reactive-programming-3/">
                <span>Reactive Programming 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-4/">
              <a href="https://1ambda.github.io/scala/reactive-programming-4/">
                <span>Reactive Programming 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-5/">
              <a href="https://1ambda.github.io/scala/reactive-programming-5/">
                <span>Reactive Programming 5     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/haskell/">
        <a href="https://1ambda.github.io/haskell/">
          <span>
            
              <b>- </b>
            
             Haskell
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-1/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-1/">
                <span>하스켈로 배우는 함수형 언어 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-2/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-2/">
                <span>하스켈로 배우는 함수형 언어 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-3/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-3/">
                <span>하스켈로 배우는 함수형 언어 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-4/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-4/">
                <span>하스켈로 배우는 함수형 언어 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-5/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-5/">
                <span>하스켈로 배우는 함수형 언어 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-6/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-6/">
                <span>하스켈로 배우는 함수형 언어 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-7/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-7/">
                <span>하스켈로 배우는 함수형 언어 7     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-8/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-8/">
                <span>하스켈로 배우는 함수형 언어 8     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-9/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-9/">
                <span>하스켈로 배우는 함수형 언어 9     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/haskell/poor-mans-concurrency-monad/">
              <a href="https://1ambda.github.io/haskell/poor-mans-concurrency-monad/">
                <span>Poor Man&#39;s Concurrency Monad     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/java/">
        <a href="https://1ambda.github.io/java/">
          <span>
            
              <b>- </b>
            
             Java
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/java/interview-questions-collection/">
              <a href="https://1ambda.github.io/java/interview-questions-collection/">
                <span>Interview Questions: Collection     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/javascripts/">
        <a href="https://1ambda.github.io/javascripts/">
          <span>
            
              <b>- </b>
            
             Javascript
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/javascripts/javascript-inheritance/">
              <a href="https://1ambda.github.io/javascripts/javascript-inheritance/">
                <span>Javascript Inheritance     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/javascripts/tips-for-webpack-and-redux/">
              <a href="https://1ambda.github.io/javascripts/tips-for-webpack-and-redux/">
                <span>Tips for Webpack and Redux     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/javascripts/rest-api-put-vs-post/">
              <a href="https://1ambda.github.io/javascripts/rest-api-put-vs-post/">
                <span>REST API: Put vs Post     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/oh-my-github/">
        <a href="https://1ambda.github.io/oh-my-github/">
          <span>
            
              <b>- </b>
            
             oh-my-github
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/oh-my-github/tutorial/">
              <a href="https://1ambda.github.io/oh-my-github/tutorial/">
                <span>10분만에 Github Profile 만들기     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/algorithm/">
        <a href="https://1ambda.github.io/algorithm/">
          <span>
            
              <b>- </b>
            
             Algorithm
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-1/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-1/">
                <span>Design and Analysis: Divide &amp; Conquer     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-2/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-2/">
                <span>Design and Analysis: Randomized Selection     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-3/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-3/">
                <span>Design and Analysis: Graph Contraction Algorithm     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-4/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-4/">
                <span>Design and Analysis: Graph Search and Connectivity     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-5/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-5/">
                <span>Design and Analysis: Dijkstra, Heap, Red-Black Tree     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-6/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-6/">
                <span>Design and Analysis: Hash Table, Universal Hashing, Bloom filters     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part1-1/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part1-1/">
                <span>Algorithm: Union Find     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part1-2/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part1-2/">
                <span>Algorithm: Analysis     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-1/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-1/">
                <span>Algorithm: Spanning Tree, Shortest Paths     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-2/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-2/">
                <span>Algorithm: Radix Sort, Suffix Sort     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-3/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-3/">
                <span>Algorithm: R-way, Ternary Tries     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-4/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-4/">
                <span>Algorithm: KMP, Boyer-Moore, Rabin-Karp     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-5/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-5/">
                <span>Algorithm: Maximum Flow (Ford-Fulkerson)     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-6/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-6/">
                <span>Algorithm: Data Compression, Huffman, LZW     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-cs188-1/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-cs188-1/">
                <span>AI (CS188): Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-cs188-2/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-cs188-2/">
                <span>AI (CS188): Search     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-1/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-1/">
                <span>AI Planning 1: Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-2/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-2/">
                <span>AI Planning 2: A*. STRIPS     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-3/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-3/">
                <span>AI Planning 3: PSP, PoP     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-4/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-4/">
                <span>AI Planning 4: STN, HTN     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/data-analysis/">
        <a href="https://1ambda.github.io/data-analysis/">
          <span>
            
              <b>- </b>
            
             Data Analysis
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-1/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-1/">
                <span>ML 01: Linear Regression     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-2/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-2/">
                <span>ML 02: Gradient Descent     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-3/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-3/">
                <span>ML 03: Logistic Regression     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-4/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-4/">
                <span>ML 04: Neural Network     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-5/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-5/">
                <span>ML 05: Back Propagation     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-6/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-6/">
                <span>ML 06: Practical Advices     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-7/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-7/">
                <span>ML 07: Support Vector Machine     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-8/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-8/">
                <span>ML 08: K-means, PCA Details     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-9/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-9/">
                <span>ML 09: Anomaly Detection, Recommender System     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-10/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-10/">
                <span>ML 10: Stochastic Gradient, Synthetic Data, Ceiling Analysis     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-1/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-1/">
                <span>Intro to Data Science 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-2/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-2/">
                <span>Intro to Data Science 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-3/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-3/">
                <span>Intro to Data Science 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-4/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-4/">
                <span>Intro to Data Science 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-1/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-1/">
                <span>Process Mining 1: Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-2/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-2/">
                <span>Process Mining 2: Alpha Algorithm     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-3/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-3/">
                <span>Process Mining 3: Metric, C-nets     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-4/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-4/">
                <span>Process Mining 4: Conformance Checking, Dotted Chart     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-5/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-5/">
                <span>Process Mining 5: Decision, Social, Organization Mining     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-1/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-1/">
                <span>Pattern Discovery 1: Apriori, FP Growth     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-2/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-2/">
                <span>Pattern Discovery 2: Null-invariant, Pattern-Fusion, Constaint     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-3/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-3/">
                <span>Pattern Discovery 3: Sequential Pattern Mining     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/cloud-computing/">
        <a href="https://1ambda.github.io/cloud-computing/">
          <span>
            
              <b>- </b>
            
             Cloud Computing
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-1/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-1/">
                <span>CC 01: Map Reduce     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-2/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-2/">
                <span>CC 02: Gossip Protocol     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-3/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-3/">
                <span>CC 03: Membership Protocol     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-4/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-4/">
                <span>CC 04: P2P Systems     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-5/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-5/">
                <span>CC 05: Global Snapshot     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-6/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-6/">
                <span>CC 06: Multicast     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-7/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-7/">
                <span>CC 07: Paxos     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/1ambda/1ambda.github.io-hugo/edit/master/content/haskell/poor-mans-concurrency-monad.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="https://1ambda.github.io/haskell/" itemprop="url"><span itemprop="title">Haskell</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                <span itemprop="title"> Poor Man&#39;s Concurrency Monad</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#continuation">Continuation</a></li>
<li><a href="#process-modeling">Process Modeling</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Poor Man&#39;s Concurrency Monad</h1>
                



<p><em>FP 101x</em> 의 최종 보스입니다. <del>Rose Tree 는 거들뿐</del> <em>Koen Claessen</em> 가 1999년에 발표한 <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.39.8039"><em>Poor Man&rsquo;s Concurrenc Monad</em></a> 를 배경으로 하는 과제인데, 언어에 <em>primitive</em> 추가 없이 <em>concurrency</em> 를 모델링 하는 방법을 보여줍니다.</p>

<h3 id="continuation">Continuation</h3>

<p>먼저 용어부터 정의하고 가면, <em>continuation</em> 은 실행 가능한 <em>computation</em> 입니다. 필요할 때 사용할려고 미뤄둔 계산인데, 이게 프로세스를 모델링 하기에 적당합니다. 왜냐하면 프로세스도 멈추었다가, 나중에 다시 실행을 해야 하니까요!</p>

<p>나중에 쓰려고 미뤄둔 계산, 즉 <em>continuation</em> 을 지속적으로 넘겨가면서 사용하는 방식을 <em>continuation passing style</em> 이라 부릅니다. <em>CPS</em> 로 작성된 함수는 리턴하는 법이 없습니다. 다만 자신의 계산을 <em>continuation</em> 으로 만들어 넘겨줄 뿐이지요.</p>

<p>코드를 먼저 보시지요. 피타고라스 계산을 하스켈에서 <em>CPS</em> 로 작성하는 방법입니다.</p>

<pre><code class="language-haskell">square :: Int -&gt; Int
square x = x * x

add :: Int -&gt; Int -&gt; Int
add x y = x + y

square_cps :: Int -&gt; (Int -&gt; r) -&gt; r
square_cps x = \cont -&gt; cont (square x)

add_cps :: Int -&gt; Int -&gt; (Int -&gt; r) -&gt; r
add_cps x y = \cont -&gt; cont (add x y)

pythagoras_cps :: Int -&gt; Int -&gt; (Int -&gt; r) -&gt; r
pythagoras_cps x y = \cont -&gt;
  square_cps x $ \squared_x -&gt;
  square_cps y $ \squared_y -&gt;
  add_cps squared_x squared_y cont
  
&gt; square_cps 3 print
-- &quot;9&quot;

&gt; add_cps 3 4 print
-- &quot;7&quot;

&gt; pythagoras_cps 3 4 print
-- &quot;25&quot;
</code></pre>

<p>위 예제에서는 <code>print</code> 가 나중에 쓸려고 모셔둔 계산, 즉 <em>continuation</em> 입니다. 이 타입 <code>(Int -&gt; r) -&gt; r</code> 을 잘 기억해 두세요.</p>

<h3 id="process-modeling">Process Modeling</h3>

<p>프로세스를 모델링 하려면 상태와 작업 두 가지를 나타내야 합니다. 먼저 프로세스가 하는 작업에 대해서 모델링을 해 보겠습니다. 프로세스는 의 작업은 <code>Action</code> 이라 부르겠습니다. <code>Action</code> 은 <code>Atom</code> 이라 부르는 <code>IO</code> 연산일 수도 있고, 자식을 만드는 <code>Fork</code> 나, 프로세스를 멈추는 <code>Stop</code> 이 될 수 있습니다.</p>

<p><code>Atom</code> 은 <em>side-effect</em> 를 만드는 <em>atomic</em> 연산이라 보면 됩니다.</p>

<pre><code class="language-haskell">data Action = 
   = Atom (IO Action)
   | Fork Action Action
   | Stop
</code></pre>

<p>프로세스는 상태를 모델링 하기 위해 프로세스의 동작에 대해서 조금 논의해 봅시다. 프로세스는 자신의 작업이 있습니다. 우리는 <code>Action</code> 으로 표현했지요. 프로세스가 어떤 이유에서든지 중단된다면, 나중을 위해서 이 <code>Action</code> 을 기억해 둬야 합니다. 다시 작업을 해야하니까요!</p>

<p>아까 위에서 보았던 <code>(Int -&gt; r) -&gt; r</code> 기억 나시나요? <em>continuation</em> <code>Int - r</code> 을 이용해 결과 <code>r</code> 을 만들어 냈던 타입이지요. 이 타입을 잘 보면, <em>continuation</em> 이 공급될 때 <em>result <code>r</code></em>  을 얻을 수 있습니다. 여기서 결과인 <code>r</code> 은 다른 프로세스에게 밀려 중단된 작업 <code>Action</code> 이라 보시면 되고, 공급되는 <em>continuation</em> 은 <em>CPU</em> 와 같은 리소스라 보시면 됩니다. (그렇게 생각하는 편이 <del>정신건강에</del> 좋습니다.)</p>

<p>그러면, 비슷하게, 이런 타입을 생각해 볼 수 있습니다.</p>

<pre><code class="language-haskell">data Concurrent a = ((a -&gt; Action) -&gt; Action)
</code></pre>

<p>이 타입은 <code>a -&gt; Action</code> <em>continuation</em> 을 받아, 결과 <code>Action</code> 을 돌려줍니다.</p>

<p>그러면 프로세스의 <strong>미뤄진 작업의 상태</strong>를 표현하는 <code>Concurrent</code> 에 <em>continuation</em> 을 공급해 <strong>미뤄진 작업</strong> <code>Action</code> 을 얻어내는 <code>action</code> 이란 함수를 만들 수 있습니다.</p>

<pre><code class="language-haskell">action :: Concurrent a -&gt; Action
action (Concurrent concur) = concur (\a -&gt; Stop)
</code></pre>

<p>또한 어떤 <em>continuation</em> 을 받던 무조건 멈추는 <code>Action</code> 을 돌려주는 <code>stop</code> 함수도 생각해 볼 수 있겠죠. 이건 <strong>멈춰진 작업의 상태</strong> 를 표현하는 <code>Concurrent</code> 라 보셔도 좋습니다.</p>

<pre><code>stop :: Concurrent 
stop = Concurrent (\cont -&gt; Stop)
</code></pre>

<p>이제 <code>IO</code> 를 <code>Concurrent</code> 로 표현하기 위해 <code>IO a -&gt; Concurrent a</code> 로 변환해주는 <code>atom</code> 을 만들겁니다. 다시 말해서 이 함수는 <strong>멈춰진 <code>IO</code> 연산</strong> 을 돌려줘 하므로 <code>Concurrent</code> 내에 <code>Atom (IO Action)</code> 을 담아야 합니다.</p>

<p><code>cont a</code> 가 <code>Action</code> 이므로, <code>do</code> 내에서 <code>return (cont a)</code> 이면 <code>IO Action</code> 타입을 얻을 수 있겠죠? 쉽게 생각해서 <em>continuation</em> 인 <code>cont</code> 가 공급될 때 <code>IO</code> 를 수행한다 보면 되겠습니다.</p>

<pre><code class="language-haskell">atom :: IO a -&gt; Concurrent a
atom \io -&gt; Concurrent $ \cont -&gt; Atom $ do a &lt;- io
                                            return (cont a)
</code></pre>

<p>이제 프로세스를 분할하는 <code>Fork</code> 작업을 생각해 봅시다. 타입만 보면 <code>Fork Action Aciton</code>  입니다. 즉 두개의 <code>Action</code> 을 <code>Concurrent</code> 내에 담아야 합니다.</p>

<pre><code class="language-haskell">fork :: Concurrent a -&gt; Concurrent ()
fork concur = Concurrent $ \cont -&gt; Fork (action concur) (cont ())
</code></pre>

<p>보면, <code>action concur</code> 로 현재 미뤄진 작업에 대한 <code>Action</code> 을 추출하고, <em>continuation</em> 를 받아 <code>cont ()</code> 로 <em>continuation</em> 에 있는 다음 <code>Action</code> 을 뽑아냅니다. <em>continuation</em> 의 타입이 <code>a -&gt; Action</code> 인거 기억 나시죠?</p>

<p>비슷하게, 두개의 미루어진 작업을 받아 <code>Fork</code> 로 만드는 <code>par</code> 함수도 만들어 봅시다.</p>

<pre><code class="language-haskell">par :: Concurrent a -&gt; Concurrent a -&gt; Concurrent a
par (Concurrent a) (Concurrent b) = Concurrent $ \cont -&gt; Fork (a cont) (b con))
</code></pre>

<p>이제 <code>Concurrent</code> 간 <em>composition</em> 을 위해 <code>&gt;&gt;=</code>, <code>return</code> 을 구현하면</p>

<pre><code class="language-haskell">instance Monad Concurrent where
    -- g :: \a -&gt; Concurrent b
    (Concurrent A) &gt;&gt;= g = 
      \contB -&gt; A (\contA -&gt; case g a of (Concurrent B) -&gt; B contB  
</code></pre>

<p>직관적인 이해는, <code>&gt;&gt;=</code> 자체는 두 <code>Concurrent</code> 간 연결입니다. 서로 다른 타입 <code>a, b</code> 에 대해서 <code>Concurrent</code> 가 어떻게 연결되야 하는지 생각해 보면 됩니다.</p>

<p><code>Concurrent a</code> 의 <code>Action</code> 을 얻기 위한  <em>continuation</em> 은, 다음 작업을 의미하는데 이 <em>continuation</em> <code>a' -&gt; Action</code> 에서의 <code>Action</code> 이 <code>Concurrent b</code> 의 <code>Action</code> 이라 보면 됩니다.</p>

<p>다시 말해서, <code>Concurrent a</code> 의 <code>Action</code> 의 다음 작업이 <code>Concurrent b</code> 의 <code>Action</code> 이란 뜻이지요.</p>

<p>마지막으로 <code>Action</code> 을 라운드 로빈 방식으로 스케쥴링하는 <code>roundRobin</code> 함수와, 실제로 <code>Concurrent a</code> 을 이용해 <code>roundRobin</code> 함수를 이용하는 <code>run</code> 함수를 보면,</p>

<pre><code class="language-haskell">roundRobin :: [Action] -&gt; IO ()
roundRobin [] = return ()
roundRobin (Atom x:xs) = x &gt;&gt;= \ac -&gt; roundRobin (xs ++ [ac])
roundRobin (Fork x y : xs) = roundRobin (xs ++ [x, y])
roundRobin (Stop : xs) = roundRobin xs

run :: Concurrent a -&gt; IO ()
run x = roundRobin [action x]
</code></pre>

<p>몇개의 헬퍼 함수와 테스트 코드도 좀 보겠습니다.</p>

<pre><code class="language-haskell">genRandom :: Int -&gt; [Int]
genRandom 1337 = [1, 96, 36, 11, 42, 47, 9, 1, 62, 73]
genRandom 7331 = [17, 73, 92, 36, 22, 72, 19, 35, 6, 74]
genRandom 2600 = [83, 98, 35, 84, 44, 61, 54, 35, 83, 9]
genRandom 42   = [71, 71, 17, 14, 16, 91, 18, 71, 58, 75]

loop :: [Int] -&gt; Concurrent ()
loop xs = mapM_ (atom . putStr . show) xs

ex0 :: Concurrent ()
ex0 = par (loop (genRandom 1337)) (loop (genRandom 2600) &gt;&gt; atom (putStrLn &quot;&quot;))

ex1 :: Concurrent ()
ex1 = do atom (putStr &quot;Haskell&quot;)
         fork (loop $ genRandom 7331) 
         loop $ genRandom 42
         atom (putStrLn &quot;&quot;)

myex0 = run $ (ho &gt;&gt; ho &gt;&gt; ho) &gt;&gt;
              (hi &gt;&gt; hi &gt;&gt; hi) &gt;&gt; atom (putStr &quot;\n&quot;)
  where ho = atom (putStr &quot;ho&quot;)
        hi = atom (putStr &quot;hi&quot;)

myex1 = run $ fork (ho &gt;&gt; ho &gt;&gt; ho) &gt;&gt;
              (hi &gt;&gt; hi &gt;&gt; hi) &gt;&gt; atom (putStr &quot;\n&quot;)
  where ho = atom (putStr &quot;ho&quot;)
        hi = atom (putStr &quot;hi&quot;)
        
myex2 = run $ fork (put3 &quot;ba&quot;) &gt;&gt; fork (put3 &quot;di&quot;) &gt;&gt;
        put3 &quot;bu&quot; &gt;&gt; atom (putStr &quot;\n&quot;)
  where put3 = sequence . take 3 . repeat . atom . putStr
        
myex3 = run $ par (put3 &quot;ba&quot;) (put3 &quot;di&quot; &gt;&gt; stop) &gt;&gt;
        atom (putStr &quot;\n&quot;)
  where put3 = sequence . take 3 . repeat . atom . putStr
        
myex4 = run $ (par (put3 &quot;ba&quot;) (put3 &quot;di&quot;)) &gt;&gt;
        atom (putStr &quot;\n&quot;)
  where put3 = sequence . take 3 . repeat . atom . putStr

myex5 :: Concurrent ()
myex5 = do fork (atom $ putStrLn &quot;test&quot;)
           atom $ putStrLn &quot;hello&quot;

myex6 :: Concurrent ()
myex6 = do val &lt;- par (atom $ return &quot;hi&quot;) (atom $ return &quot;hello&quot;)
           atom $ putStrLn val
</code></pre>

<h2 id="references">References</h2>

<p>(1) <strong>DelftX FP 101x</strong><br />
(2) <em>Programming in Haskell</em><br />
(3) <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.39.8039">A Poor Man&rsquo;s Concurrency Monad</a></p>

<br/>
<br/>
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = '1ambda';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      
      </div>
    </div>

    <div id="navigation">
        <a class="nav nav-prev" href="../intro-to-haskell-9"> <i class="fa fa-chevron-left"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://1ambda.github.io/js/clipboard.min.js"></script>
    <script src="https://1ambda.github.io/js/perfect-scrollbar.min.js"></script>
    <script src="https://1ambda.github.io/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://1ambda.github.io/js/jquery.sticky-kit.min.js"></script>
    <script src="https://1ambda.github.io/js/featherlight.min.js"></script>
    <script src="https://1ambda.github.io/js/html5shiv-printshiv.min.js"></script>
    <script src="https://1ambda.github.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://1ambda.github.io/js/modernizr.custom.71422.js"></script>
    <script src="https://1ambda.github.io/js/learn.js"></script>
    <script src="https://1ambda.github.io/js/hugo-learn.js"></script>
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-52181619-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


  </body>
</html>


