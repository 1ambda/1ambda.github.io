<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.18-DEV" />
    <meta name="description" content="hugo content for 1ambda.github.io">
<meta name="author" content="1ambda">

    <link rel="shortcut icon" href="https://1ambda.github.io/images/favicon.png" type="image/x-icon" />

    
    <title>Reactive Programming 3</title>
    <link href="https://1ambda.github.io/css/nucleus.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/hybrid.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/featherlight.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/horsey.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/theme.css" rel="stylesheet">
    <link href="https://1ambda.github.io/css/hugo-theme.css" rel="stylesheet">
    <script src="https://1ambda.github.io/js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link href="https://1ambda.github.io/css/theme-1ambda.css" rel="stylesheet">

  </head>
  <body class="" data-url="/scala/reactive-programming-3/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a href="https://1ambda.github.io/home" style="color: white; margin-top:10px;">
  <div> <i class="fa fa-github fa-4x"></i> </div>
</a>
<div style="margin-top:5px; font-size: 25px;">1ambda</div>

    </div>
    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/home/">
        <a href="https://1ambda.github.io/home/">
          <span>
            
              <b>HOME</b>
            
             
            
           </span>
        </a>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/infrastructure/">
        <a href="https://1ambda.github.io/infrastructure/">
          <span>
            
              <b>- </b>
            
             Infrastructure
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/infrastructure/container/kubernetes-intro/">
              <a href="https://1ambda.github.io/infrastructure/container/kubernetes-intro/">
                <span>Kubernetes: Intro     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/golang/">
        <a href="https://1ambda.github.io/golang/">
          <span>
            
              <b>- </b>
            
             Golang
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/golang/golang-tutorial/">
              <a href="https://1ambda.github.io/golang/golang-tutorial/">
                <span>Golang Tutorial     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/scala/">
        <a href="https://1ambda.github.io/scala/">
          <span>
            
              <b>-</b>
            
             Scala
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-1/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-1/">
                <span>Easy Scalaz 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-2/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-2/">
                <span>Easy Scalaz 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-3/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-3/">
                <span>Easy Scalaz 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-4/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-4/">
                <span>Easy Scalaz 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-5/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-5/">
                <span>Easy Scalaz 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/easy-scalaz-6/">
              <a href="https://1ambda.github.io/scala/easy-scalaz-6/">
                <span>Easy Scalaz 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-1/">
              <a href="https://1ambda.github.io/scala/functional-programming-1/">
                <span>Functional Programming 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-2/">
              <a href="https://1ambda.github.io/scala/functional-programming-2/">
                <span>Functional Programming 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-3/">
              <a href="https://1ambda.github.io/scala/functional-programming-3/">
                <span>Functional Programming 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-4/">
              <a href="https://1ambda.github.io/scala/functional-programming-4/">
                <span>Functional Programming 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-5/">
              <a href="https://1ambda.github.io/scala/functional-programming-5/">
                <span>Functional Programming 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-6/">
              <a href="https://1ambda.github.io/scala/functional-programming-6/">
                <span>Functional Programming 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/functional-programming-7/">
              <a href="https://1ambda.github.io/scala/functional-programming-7/">
                <span>Functional Programming 7     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-1/">
              <a href="https://1ambda.github.io/scala/reactive-programming-1/">
                <span>Reactive Programming 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-2/">
              <a href="https://1ambda.github.io/scala/reactive-programming-2/">
                <span>Reactive Programming 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/scala/reactive-programming-3/">
              <a href="https://1ambda.github.io/scala/reactive-programming-3/">
                <span>Reactive Programming 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-4/">
              <a href="https://1ambda.github.io/scala/reactive-programming-4/">
                <span>Reactive Programming 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/scala/reactive-programming-5/">
              <a href="https://1ambda.github.io/scala/reactive-programming-5/">
                <span>Reactive Programming 5     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/haskell/">
        <a href="https://1ambda.github.io/haskell/">
          <span>
            
              <b>- </b>
            
             Haskell
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-1/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-1/">
                <span>하스켈로 배우는 함수형 언어 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-2/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-2/">
                <span>하스켈로 배우는 함수형 언어 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-3/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-3/">
                <span>하스켈로 배우는 함수형 언어 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-4/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-4/">
                <span>하스켈로 배우는 함수형 언어 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-5/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-5/">
                <span>하스켈로 배우는 함수형 언어 5     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-6/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-6/">
                <span>하스켈로 배우는 함수형 언어 6     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-7/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-7/">
                <span>하스켈로 배우는 함수형 언어 7     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-8/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-8/">
                <span>하스켈로 배우는 함수형 언어 8     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/intro-to-haskell-9/">
              <a href="https://1ambda.github.io/haskell/intro-to-haskell-9/">
                <span>하스켈로 배우는 함수형 언어 9     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/haskell/poor-mans-concurrency-monad/">
              <a href="https://1ambda.github.io/haskell/poor-mans-concurrency-monad/">
                <span>Poor Man&#39;s Concurrency Monad     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/java/">
        <a href="https://1ambda.github.io/java/">
          <span>
            
              <b>- </b>
            
             Java
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/java/interview-questions-collection/">
              <a href="https://1ambda.github.io/java/interview-questions-collection/">
                <span>Interview Questions: Collection     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/javascript/">
        <a href="https://1ambda.github.io/javascript/">
          <span>
            
              <b>- </b>
            
             Javascript
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/javascript/javascript-inheritance/">
              <a href="https://1ambda.github.io/javascript/javascript-inheritance/">
                <span>Javascript Inheritance     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/javascript/tips-for-webpack-and-redux/">
              <a href="https://1ambda.github.io/javascript/tips-for-webpack-and-redux/">
                <span>Tips for Webpack and Redux     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/javascript/rest-api-put-vs-post/">
              <a href="https://1ambda.github.io/javascript/rest-api-put-vs-post/">
                <span>REST API: Put vs Post     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/oh-my-github/">
        <a href="https://1ambda.github.io/oh-my-github/">
          <span>
            
              <b>- </b>
            
             oh-my-github
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/oh-my-github/tutorial/">
              <a href="https://1ambda.github.io/oh-my-github/tutorial/">
                <span>10분만에 Github Profile 만들기     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/algorithm/">
        <a href="https://1ambda.github.io/algorithm/">
          <span>
            
              <b>- </b>
            
             Algorithm
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-1/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-1/">
                <span>Design and Analysis: Divide &amp; Conquer     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-2/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-2/">
                <span>Design and Analysis: Randomized Selection     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-3/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-3/">
                <span>Design and Analysis: Graph Contraction Algorithm     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-4/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-4/">
                <span>Design and Analysis: Graph Search and Connectivity     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-5/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-5/">
                <span>Design and Analysis: Dijkstra, Heap, Red-Black Tree     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/design-and-analysis-part1-6/">
              <a href="https://1ambda.github.io/algorithm/design-and-analysis-part1-6/">
                <span>Design and Analysis: Hash Table, Universal Hashing, Bloom filters     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part1-1/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part1-1/">
                <span>Algorithm: Union Find     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part1-2/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part1-2/">
                <span>Algorithm: Analysis     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-1/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-1/">
                <span>Algorithm: Spanning Tree, Shortest Paths     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-2/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-2/">
                <span>Algorithm: Radix Sort, Suffix Sort     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-3/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-3/">
                <span>Algorithm: R-way, Ternary Tries     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-4/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-4/">
                <span>Algorithm: KMP, Boyer-Moore, Rabin-Karp     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-5/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-5/">
                <span>Algorithm: Maximum Flow (Ford-Fulkerson)     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/algorithm-part2-6/">
              <a href="https://1ambda.github.io/algorithm/algorithm-part2-6/">
                <span>Algorithm: Data Compression, Huffman, LZW     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-cs188-1/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-cs188-1/">
                <span>AI (CS188): Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-cs188-2/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-cs188-2/">
                <span>AI (CS188): Search     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-1/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-1/">
                <span>AI Planning 1: Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-2/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-2/">
                <span>AI Planning 2: A*. STRIPS     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-3/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-3/">
                <span>AI Planning 3: PSP, PoP     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/algorithm/artificial-intelligence-planning-4/">
              <a href="https://1ambda.github.io/algorithm/artificial-intelligence-planning-4/">
                <span>AI Planning 4: STN, HTN     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/data-analysis/">
        <a href="https://1ambda.github.io/data-analysis/">
          <span>
            
              <b>- </b>
            
             Data Analysis
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-1/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-1/">
                <span>ML 01: Linear Regression     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-2/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-2/">
                <span>ML 02: Gradient Descent     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-3/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-3/">
                <span>ML 03: Logistic Regression     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-4/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-4/">
                <span>ML 04: Neural Network     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-5/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-5/">
                <span>ML 05: Back Propagation     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-6/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-6/">
                <span>ML 06: Practical Advices     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-7/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-7/">
                <span>ML 07: Support Vector Machine     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-8/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-8/">
                <span>ML 08: K-means, PCA Details     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-9/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-9/">
                <span>ML 09: Anomaly Detection, Recommender System     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/machine-learning-week-10/">
              <a href="https://1ambda.github.io/data-analysis/machine-learning-week-10/">
                <span>ML 10: Stochastic Gradient, Synthetic Data, Ceiling Analysis     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-1/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-1/">
                <span>Intro to Data Science 1     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-2/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-2/">
                <span>Intro to Data Science 2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-3/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-3/">
                <span>Intro to Data Science 3     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/intro-to-data-science-4/">
              <a href="https://1ambda.github.io/data-analysis/intro-to-data-science-4/">
                <span>Intro to Data Science 4     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-1/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-1/">
                <span>Process Mining 1: Intro     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-2/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-2/">
                <span>Process Mining 2: Alpha Algorithm     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-3/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-3/">
                <span>Process Mining 3: Metric, C-nets     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-4/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-4/">
                <span>Process Mining 4: Conformance Checking, Dotted Chart     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/process-mining-5/">
              <a href="https://1ambda.github.io/data-analysis/process-mining-5/">
                <span>Process Mining 5: Decision, Social, Organization Mining     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-1/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-1/">
                <span>Pattern Discovery 1: Apriori, FP Growth     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-2/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-2/">
                <span>Pattern Discovery 2: Null-invariant, Pattern-Fusion, Constaint     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/data-analysis/pattern-discovery-3/">
              <a href="https://1ambda.github.io/data-analysis/pattern-discovery-3/">
                <span>Pattern Discovery 3: Sequential Pattern Mining     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/cloud-computing/">
        <a href="https://1ambda.github.io/cloud-computing/">
          <span>
            
              <b>- </b>
            
             Cloud Computing
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-1/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-1/">
                <span>CC 01: Map Reduce     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-2/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-2/">
                <span>CC 02: Gossip Protocol     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-3/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-3/">
                <span>CC 03: Membership Protocol     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-4/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-4/">
                <span>CC 04: P2P Systems     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-5/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-5/">
                <span>CC 05: Global Snapshot     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-6/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-6/">
                <span>CC 06: Multicast     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/cloud-computing/cloud-computing-7/">
              <a href="https://1ambda.github.io/cloud-computing/cloud-computing-7/">
                <span>CC 07: Paxos     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/1ambda/1ambda.github.io-hugo/edit/master/content/scala/reactive-programming-3.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="https://1ambda.github.io/scala/" itemprop="url"><span itemprop="title">Scala</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> Reactive Programming 3</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#try-future-promise">Try, Future, Promise</a>
<ul>
<li><a href="#monads-and-effects">Monads and Effects</a>
<ul>
<li><a href="#try">Try</a></li>
</ul></li>
<li><a href="#latency-as-an-effect">Latency as an Effect</a></li>
<li><a href="#combinators-on-futures">Combinators on Futures</a>
<ul>
<li><a href="#awaitable">Awaitable</a></li>
</ul></li>
<li><a href="#composing-futures">Composing Futures</a></li>
<li><a href="#async">Async</a></li>
<li><a href="#promise">Promise</a></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Reactive Programming 3</h1>
                



<h2 id="try-future-promise">Try, Future, Promise</h2>

<p>이번시간엔 <em>Try</em>, <em>Future</em>, <em>Awaitable</em>, <em>Async</em>, <em>Promise</em> 에 대해 알아본다. <del>모나드가 삶을 윤택하게 하리라</del></p>

<h3 id="monads-and-effects">Monads and Effects</h3>

<p>프로그래밍에서 4가지 본질적 <em>effects</em> 는</p>

<pre><code>                  One           Many
                  
Synchronous     T/Try[T]     Iterable[T]
Asynchronous    Future[T]    Observable[T]
</code></pre>

<p><em>asynchoronous computation</em> 을 살펴보기전에 <em>synchronous</em> 부터 살펴볼건데 간단한 어드벤쳐 게임으로 시작하자.</p>

<pre><code class="language-scala">trait Adventure {
  def collectCoins(): List[Coin]
  def buyTreasure(coins: List[Coin]): Treasure
}

val adventu
re = Adventrue()
val coins = adventure.collectCoins()
val treasure = adventure.buyTreasure(coins)
</code></pre>

<p>여기서 <code>collecCoins, buyTreasure</code> 는 구현에 따라 실패할 수도 있다. 예를 들어</p>

<pre><code class="language-scala">def collectCoins(): List[Coin] = {
  if (eatenByMonster(this)) throw new GameOverException(&quot;Ooops&quot;)
  List(Silver, Silver, Gold)
}
def buyTreasure(coins: List[Coin]): Treasure = {
  if (coins.sumBy(_.value) &lt; treasureCost)
    throw new GameOverException(&quot;Nice try!&quot;)
  Diamond
}
</code></pre>

<p>그런데, 타입상으로는 <code>collectCoins, buyTreasure</code> 는 함수가 실패할 것이라는 어떠한 정보도 주지 않는다. <code>Try</code> 를 이용해 함수가 예외를 던질수도 있다는 것을 타입에 표시하자.</p>

<h4 id="try">Try</h4>

<p>아래는 <code>Try</code> 의 정의다.</p>

<pre><code class="language-scala">abstract class Try[T]
case class Success[T](elem: T) extends Try[T]
case class Failure[T](t: Throwable) extends Try[Nothing]
</code></pre>

<p>이걸 게임 함수의 리턴값에 적용하면</p>

<pre><code class="language-scala">import scala.util.{Try, Success, Failure}

def collectCoins(): Try[List[Coin]] = {
  if (eatenByMonster(this)) throw new GameOverException(&quot;Ooops&quot;)
  List(Silver, Silver, Gold)
}
def buyTreasure(coins: List[Coin]): Try[Treasure] = {
  if (coins.sumBy(_.value) &lt; treasureCost)
    throw new GameOverException(&quot;Nice try!&quot;)
  Diamond
}

val adventure = Adventrue()
val coins: Try[List[Coin]] = adventure.collectCoins()
val treasure = coins match {
  case Success(cs) =&gt; adventure.buyTreasure(cs)
  case failure @ Failure(t) =&gt; failure
}
</code></pre>

<p>좀 귀찮다. 많이 귀찮다. <em>higher order function</em> 의 은혜를 받아 삶을 좀 윤택하게 해 보자.</p>

<pre><code class="language-scala">def flatMap[S](f: T =&gt; Try[S]): Try[S]

def flatten[U &lt;: Try[T]]: TRy[U]

def map[S](f: T =&gt; S): Try[T]

def filter(p: T =&gt; Boolean): Try[T]

def recoverWith(f: PartialFunction[Throwable, Try[T]]): Try[T]
</code></pre>

<p>여기서 <code>flatMap</code> 을 이용하면 코드가 상당히 이뻐질 것 같다.</p>

<p>사실 비밀을 하나 공개하자면, <code>Try[T]</code> 는 모나드다. 그 중에서 <em>exception</em> 을 다루는 모나드.</p>

<p><code>Try</code> 모나드를 이용하면 <em>exception</em> 부분(<code>Try[T]</code>)은 알아서 다루어 주고, 우리가 다뤄야 할 <code>T</code> 부분에 집중하게 해준다.</p>

<p><code>flatMap</code> 이 코드를 어떻게 바꾸는가 한번 보자.</p>

<pre><code class="language-scala">val treasure: Try[Treasure] = 
  adventure.collectCoins().flatMap(coins =&gt; {
    adventure.buyTreasure(coins)
  }
</code></pre>

<p>리턴타입은 <code>Try[Treasure]</code> 인데 <code>Try</code> 패턴매칭이 사라졌다? 그게 바로 <code>flatMap</code> 이 해주는 일이다. 타입을 다시 보자.</p>

<pre><code class="language-scala">def flatMap[S](f: T =&gt; Try[S]): Try[S]
</code></pre>

<p><code>T</code> 를 받아 <code>Try[S]</code> 를 돌려줄 함수만 넣어주면, 실제 <code>T</code> 를 이 함수에 넣기 위해 해야할 패턴매칭은 알아서 해준다.</p>

<p>그리고 지난 <a href="http://1ambda.github.io/reactive-programming-1/">1강</a> 에서 모나드속에 있는 타입을 빼기 위해 <em>for expression</em> 을 이용했었다. 마찬가지로 <code>Try</code> 도 가능하다. <code>flatMap</code> 보다 더 이뻐진다.</p>

<pre><code class="language-scala">val treasure: Try[Treasure] = for {
  coins &lt;- adventure.collectCoins()
  treasure &lt;- adventure.buyTreasure(coins)
} yield treasure
</code></pre>

<p>우측에서 <code>Try[T]</code> 를 리턴하고, <code>for</code> 가 알아서 <code>Try</code> 를 제거하고 좌측에 <code>T</code> 를 돌려준다.</p>

<p><code>Try</code> 를 다루기 위한 <em>higher order function</em> 이 내부적으로 어떻게 돌아가는지 한번 살펴보자.</p>

<pre><code class="language-scala">def map[S](f: T =&gt; S): Try[S] = this match {
  case Succes(value) =&gt; Try(f(Value))
  case failure @ Failure(t) =&gt; failure
}

def flatMap[S](f: T =&gt; Try[S]): Try[S] = this match {
  case Success(value) =&gt; try { f(value) } catch { cast t =&gt; Failure(t) }
  case failure @ Failure(t) =&gt; failure
}

object Try {
  def apply[T](r: =&gt; T): Try[T] = {
    try { Success(r) }
    catch { case t =&gt; Failure(t) }
  }
}
</code></pre>

<p><code>flatMap</code> 내부에서 패턴매칭 및 예외 처리를 해준다.</p>

<h3 id="latency-as-an-effect">Latency as an Effect</h3>

<pre><code>                  One           Many
                  
Synchronous     T/Try[T]     Iterable[T]
Asynchronous    Future[T]    Observable[T]
</code></pre>

<p>지금까지 <code>T/Try[T]</code> 에 대해서 봤다. 이번엔 <em>asynchronous</em> 로 옮겨가 <code>Future[T]</code> 를 한번 볼건데, 간단한 네트워크 프로그램을 모델링 하면서 배워보자.</p>

<pre><code class="language-scala">trait Socket {
  def readFromMemory(): Array[Byte]
  def sendToEurope(packet: Array[Byte]): Array[Byte]
}

val socket = Socket()
val packet = socket.readFromMemory()
val confirmation = socket.sendToEurope(package)
</code></pre>

<p>이 코드도 이전의 어드벤쳐 게임처럼 실행중 어떤일이 발생할지 모른다. 예외가 발생하지 않았을때만 정상적으로 실행된다. 게다가 <code>readFromMemory</code>, <code>sendToEurope</code> 동안 함수가 블럭되면 프로그램은 멈춰있다. (<em>heavy effect</em>)</p>

<p>이걸 해결하는게 <em>Future</em> 모나드다. 이 모나드는 <em>exception</em> 과 <em>latency</em> 를 다룬다. <code>Future[T]</code> 의 정의는</p>

<pre><code class="language-sala">import scala.concurrent._
import scala.concurrent._ExecutionContext.Implicits.global

trait Future[T] {
  def onComplete(callback: Try[T] =&gt; Unit)
     (implicit excutor: ExecutionContext): Unit
}
</code></pre>

<p><code>Try[T]</code> 를 받는 콜백을 인자로 필요로 하는 <code>onComplete</code> 메소드가 있다. 아랫 부분에 <code>ExecutionContext</code> 는 백그라운드에서 다른 스레드로 돌리기 위해 사용하고, <code>implicit</code> 는 이런 디테일을 숨기기 위함이다.</p>

<p><em>Future</em> 는 다른 버전으로 작성될 수도 있는데,</p>

<pre><code class="language-scala">trait Future[T] {
  def onComplete(success: T =&gt; Unit, 
                 failed Throwale =&gt; Unit): Unit
                 
  def onComplete(callback: Observer[T]): Unit
}

trait Observer[T] {
  def onNext(value: T): Unit
  def onError(error: Throwable): Unit
}
</code></pre>

<p>이건 위 버전에서의 <em>callback</em> 을 좀 세분화 한것이다. 어차피 콜백이 <code>Try[T]</code> 를 받기 때문에 내부에서 <em>case</em> 로 분리해야 하는데, 미리 로직을 분리해서 각각의 경우에 대해 넘겨주는 것이다.</p>

<p>아니면 그 아래 <code>onComplete</code> 정의처럼 <code>Observer</code> 로 감싸서 줄 수 있다. 이것도 마찬가지로 성공했을때의, 실패했을때의 콜백이다.</p>

<p>이제 처음의 소켓 프로그램으로 돌아와서 <em>Future</em> 를 적용하면</p>

<pre><code class="language-scala">trait Future[T] {
  def onComplete(callback: Try[T] =&gt; Unit)
     (implicit executor: ExecutionContext): Unit
}

trait Socket {
  def readFromMemory(): Future[Array[Byte]]
  def sendToEurope(package: ArrayByte]): Future[Array[Byte]]
}
</code></pre>

<p>이제 <code>readFromMemory(), sendToEurope()</code> 의 함수 호출이 긴 시간이 걸릴수 있겠구나 하고 <code>Future</code> 가 리턴입에 있음을 보고 알 수 있다.</p>

<p><em>future</em> 는 참 좋은건데, 이걸 사용하면 아까 실행 코드는</p>

<pre><code class="language-scala">// before
val socket = Socket()
val packet = socket.readFromMemory()
val confirmation = socket.sendToEurope(package)

// after
val socket = Socket()
val packet: Future[Array[Byte]] = socket.readFromMemory()

// can't compile
val confirmation: Future[Array[Byte]] = 
  packet onComplete {
    case Success(p) =&gt; socket.sendToEurope(p)
    case Failure(t) =&gt; ...
  }
</code></pre>

<p>잘 보면 <code>onComplete</code> 의 리턴타입은 <code>Unit</code> 이기 때문에 <code>confirmation</code> 은 <code>Future[Array[Byte]]</code> 가 될 수 없다.</p>

<p>한 가지 방법은 <code>confirmation</code> 을 내부에 넣는건데,   그러면 나머지 밑 부분 코드도 모두 <code>Success</code> 내부에 작성해야 한다. <del>자바스크립트 콜백헬</del></p>

<pre><code class="language-scala">// can't compile
  packet onComplete {
    case Success(p) =&gt; 
      val confirmation = socket.sendToEurope(p)
      ...
      ...
      // callback hell
      ...
    case Failure(t) =&gt; ...
  }
</code></pre>

<p>이 문제를 해결하기 위해 <em>future</em> 를 만들 수 있다. <code>Future</code> 의 <em>companion object</em> 정의를 보면</p>

<pre><code class="language-scala">object Future {
  def apply(body =&gt; T)
     (implicit context: ExecutionContext): Future[T]
}
</code></pre>

<p>예제를 보면</p>

<pre><code class="language-scala">import scala.concurrent.ExecutionContext.Implicit.global
import akka.serializer._

val memory = Queue[EmailMessage](
  EmailMessage(from = &quot;Erik&quot;,   to = &quot;Roland&quot;)
  EmailMessage(from = &quot;Martin&quot;, to = &quot;Erik&quot;)
  EmailMessage(from = &quot;Roland&quot;, to = &quot;Martin&quot;))
  
def readFromMemory(): Future[Array[Byte]] = Future {
  val email = queue.dequeue()
  val serializer = serialization.findSerializationFor(email)
  serializer.toBinary(email)
}

val packet: Future[Array[Byte]] = socket.readFromMemory()

packet onSuccess {
  case bs =&gt; socket.sendToEurope(p)
}

packet onSuccess {
  case bs =&gt; socket.sendToEurope(p)
}
</code></pre>

<p>이렇게 사용할 수 있다. 이 코드가 모두 실행되면, 이메일 큐에는 두개의 이메일이 남는다. <strong>하나가 아니다!!</strong> <code>Future</code>  <strong>미래에 돌려줄 결과</strong>를 가지고 있다고 보면 되는데, 하나의 결과에 대해 두개의 콜백을 호출해도 하나의 결과, 즉 이메일 하나만 뽑아먹었다는 사실은 변하지 않는다.</p>

<h3 id="combinators-on-futures">Combinators on Futures</h3>

<p>이제 <em>future</em> 가 무슨일을 하는지 알았으면, 이걸 어떻게 모나드스럽게 사용할지 알아보자. 단골손님 <code>flatMap</code> 과 그 친구들이 등장한다.</p>

<pre><code class="language-scala">trait Awaitable[T] extends AnyRef {
  abstract def ready(atMost: Duration): Unit
  abstract def result(atMost: Duration): T
}

trait Future[T] extends Awaitable[T] {
  def filter(p: T =&gt; Boolean): Future[T]
  def flatMap[S](f: T =&gt; Future[S]): Future[S]
  def map[S](f: T =&gt; S): Future[S]
  def recoverWith(f: PartialFunction[Throwable, Future[T]]): Future[T]
}

objec Future {
  def apply[T](body: =&gt; T): Future[T]
}
</code></pre>

<p><code>flatMap</code> 님을 이용해서 코드를 작성하자.</p>

<pre><code class="language-scala">val socket = Socket()
val packet: Future[Array[Byte]] = socket.readFromMemor()
val confirmation: Future[ArrayByte]] = 
  packet.flatMap(p =&gt; {
    socket.sendToEurope(p)
  }
</code></pre>

<p><code>flatMap</code> 의 정의를 보면 알겠지만, 함수 <code>f: T =&gt; Future[S]</code> 만 제공하면 앞의 <code>Future</code> 를 껍질을 벗겨, <code>T</code> 로 넣어준다. 근데 여기서 재밌는 사실은, <code>flatMap</code> 의 리턴 타입이 <code>Future[S]</code> 기 때문에 <code>confirmation</code> 도 같은 타입이 된다.</p>

<p>즉, <code>flatMap</code> 을 이용하면 모나드를 체이닝할 수 있다. 다른 예제도 좀 보자.</p>

<pre><code class="language-scala">import scala.concurrent.ExecutionContext.Implicits.global
import scala.imaginary.Http._

object Http {
  def apply(url: URL, req: Request): Future[Response] = 
  { .. runs the http request asynchronously }
}

// buggy
def sendToEurope(packet: Array[Byte]): Future[Array[Byte]] = 
  Http(URL(&quot;mail.server.eu&quot;), Request(packet))
    .filter(response =&gt; response.isOK)
    .map(response =&gt; response.toByteArray)
</code></pre>

<p>마지막 부분의 코드를 다양하게 활용해 보자.</p>

<pre><code class="language-scala">def sendTo(url: URL, packet: Array[Byte]): Future[Array[Byte]] = 
  Http(URL(&quot;mail.server.eu&quot;), Request(packet))
    .filter(response =&gt; response.isOK)
    .map(response =&gt; response.toByteArray)
    
def sendToAndBackup(packet: Array[Byte]):
  Future[(Array[Byte], Array[Byte])] = {
    val europeConfirm = sendTo(mailServer.europe, packet)
    val usaConfirm    = sendTo(mailServer.usa, packet)
    europeConfirm.zip(usaConfirm)
  }
</code></pre>

<p>는 정상적인 코드가 아니다. 유럽이나 미국 둘중 하나라도 실패하면, 전체가 실패한다. 다행히도 스칼라 디자이너가 이런 문제를 해결하기 위한 함수들 <code>recover, recoverWith</code> 를 준비 해 놓았다.</p>

<pre><code class="language-scala">def recover(f: PartialFunction[Throwable, T]): Future[T]
def recoverWIth(f: PartialFunction[Throwable, Future[T]): Future[T]
</code></pre>

<p>타입을 잘보면 예외를 검사해서 다시 <code>Future[T]</code> 를 던지는 함수들이다. 특히 <code>recoverWith</code> 는 또 다른 비동기 연산을 할 수 있도록 <code>Future[T]</code> 를 지원한다.</p>

<p>위의 이메일 예제에 <code>recover, recoverWith</code> ¼ 적용해 보자.</p>

<pre><code class="language-scala">def sendTo(url: URL, packet: Array[Byte]): Future[Array[Byte]] = 
  Http(URL(&quot;mail.server.eu&quot;), Request(packet))
    .filter(response =&gt; response.isOK)
    .map(response =&gt; response.toByteArray)

def sendToAndBackup(packet: Array[Byte]): Future[Array[Byte]] = 
  sendTo(mailServer.europe, packet) recoverWith {
    case europeError =&gt; sendTo(mailServer.usa, packet) recover {
      case usaError =&gt; usaError.getMessage.toByteArray      
    }
  }
</code></pre>

<p>근데 마지막 부분에서 <code>usaError.getMessage.toByteArray</code> 가 별로 맘에 안든다.  미국으로 보내는건 백업일 뿐이고, 실제로는 유럽에 보내고 싶었다. 그래서 실패한 메세지를 받더라도 유럽쪽 에러를 받고 싶다. 또 다른 문제는 코드가 좀 못생겼다. 이 두가지 문제를 해결해보자.</p>

<pre><code class="language-scala">def fallbackTo(that: =&gt; Future[T]): Future[T] = {
  if this future fails take the successful result
  of that future
  if that future fails too, take the error of
  this future
}
</code></pre>

<p>이런 메소드가 있다면 다음처럼 작성할 수 있다.</p>

<pre><code class="language-scala">def sendSafe(packet: Array[Byte]): Future[Array[Byte]] = 
  sendTo(mailServer.europe, packet) fallbackTo {
    sendTo(mailServer.usa, packet)
  } recover {
    case europeError =&gt; europeError.getMessage.toByteArray
  }
</code></pre>

<p><code>fallbackTo</code> 의 구현은</p>

<pre><code class="language-scala">def fallbackTo(that: =&gt; Future[T]): Future[T] = {
  this recoverWith {
    case _ =&gt; that recoverWith { case _ =&gt; this }
  }
}
</code></pre>

<p><code>Try</code> 에 실패했을때 복구하는 <code>Try</code> 를 만들 수 있다.</p>

<pre><code class="language-scala">object Try {
  def apply(f: Future[T]): Future[Try[T]] = 
    f.map(s =&gt; Success(s)) recover { case t =&gt; Failure(t) }
}
</code></pre>

<h4 id="awaitable">Awaitable</h4>

<pre><code class="language-scala">trait Awaitable[T] extends AnyRef {
  abstract def ready(atMost: Duration): Unit
  abstract def result(atMost: Duration): T
}

trait Future[T] extends Awaitable[T] {
  def filter(p: T =&gt; Boolean): Future[T]
  def flatMap[S](f: T =&gt; Future[S]): Future[S]
  def map[S](f: T =&gt; S): Future[S]
  def recoverWith(f: PartialFunction[Throwable, Future[T]]): Future[T]
}
</code></pre>

<p>때때로 <em>asynchronous</em> 보다는 <em>blocking</em> 을 원할 수 있다. 그럴때는 <code>Awaitable</code> 을 사용하면 된다. 지정된 시간동안 블럭 후에 <code>result</code> 함수는 모나드를 벗겨 <code>T</code> 를 돌려준다.</p>

<p>예를 들어</p>

<pre><code class="language-scala">val socket = Socket()
val packet: Future[Array[Byte]] = socket.readFromMemory()
val confirmation: Future[Array[Byte]] = 
  packet.flatMap(socket.sendToSafe(_))

val c = Await.result(confirmation, 2 seconds)
println(c.toText)
</code></pre>

<p>여기 잘 보면 <code>2 seconds</code> 라고 썼는데, 진짜 동작하는 코드다.</p>

<pre><code class="language-scala">import scala.language.postFixOps

object Duration {
  def apply(length: Long, unit: TimeUnit): Duration
}

val fiveYears = 1826 minutes
</code></pre>

<h3 id="composing-futures">Composing Futures</h3>

<pre><code class="language-scala">val socket = Socket()
val packet: Future[Array[Byte]] = 
  socket.readFromMemory()
  
val confirmation: Future[Array[Byte]] = 
  packet.flatmap(socket.sendToSafe(_))
</code></pre>

<p>위에서 이런 코드를 작성했었다. 당연히 <em>for expression</em> 으로 변환할 수 있다.</p>

<pre><code class="language-scala">val socket = Socket()

val confirmation: Future[Array[Byte]] = for {
  packet  &lt;- socket.readFromMemory()
  confirm &lt;- socket.sendToSafe(packet)
} yield confirm
</code></pre>

<p>여기에 더 많은 <em>control flow</em> 를 도입하려면 어떻게 해야할까? <code>flatMap</code> 만으로는 좀 부족해보인다. 예를 들어 정해진 횟수만큼 <em>retry</em> 를 하고싶다고 하자. 이런 함수를 만들어야 하는데,</p>

<pre><code class="language-scala">def retry(times: Int)(block: =&gt; Future[T]): Future[T]
</code></pre>

<p>재귀로 구현하면</p>

<pre><code class="language-scala">def retry(times: Int)(block: =&gt; Future[T]): Future[T] = {
  if (times == 0) Future.failed(new Exeception(&quot;Sorry&quot;)
  else 
    block fallbackTo { 
      retry(times - 1) { block }
    }
}
</code></pre>

<p>음&hellip; 못생겼다. 재귀긴 한데.. 에릭 마이어에 의하면 <em>recursion</em> 은 함수형 프로그래밍의 <strong>GOTO</strong> 라고 한다. 재귀 말고 <em>fold</em> 를 사용하자.</p>

<pre><code class="language-scala">def retry(times: Int)(block: =&gt; Futurep[T]): Future[T] = {
  val ns: Iterator[Int] = (1 to times).iterator
  val attempts: Iterator[Future[T]] = ns.map(_ =&gt; () =&gt; block)
  val failed = Future.failed(new Exception)

  attempts.foldLeft(failed)
    ((a, block) =&gt; a recoverWith { block() })
}
</code></pre>

<p>즉, <em>future</em> 를 받아 <code>times</code> 만큼의 리스트를 만들어 놓고, <em>fold</em> 를 이용해 <code>recoverWith</code> 를 호출한다.</p>

<p>따라서 <code>retry(3) { block }</code> 코드는 이렇게 확장된다.</p>

<pre><code class="language-scala">((failed recoverWith block) recoverWith block) recoverWith block
</code></pre>

<p>만약 <em>foldRight</em> 를 이용하면</p>

<pre><code class="language-scala">def fallbackTo(that: =&gt; Future[T]): Future[T] = {
  this recoverWith {
    case _ =&gt; that recoverWith { case _ =&gt; this }
  }
}

def retry(times: Int)(block: =&gt; Futurep[T]): Future[T] = {
  val ns: Iterator[Int] = (1 to times).iterator
  val attempts: Iterator[Future[T]] = ns.map(_ =&gt; () =&gt; block)
  val failed = Future.failed(new Exception)

  attempts.foldRight(() =&gt; failed)
    ((block, a) =&gt; () =&gt; { block() fallbackTo { a() } })
}

retry(3) { block } ()

// ==
block fallbackTo { block fallbackTo { block fallbackTo { failed }}}
</code></pre>

<p>잘보면 <code>foldRight</code> 부분에서 초기값이 <code>() =&gt; failed</code> 로 변했다. 이는 우리가 <code>fallbackTo</code> 를 이용하기 때문인데, <code>fallbackTo</code> 의 로직상 <code>this</code> 가 실패하면 <code>that</code> 을 시도하게끔 되어있다. <code>that</code> 이 성공하면 <code>that</code> 을 돌려준다.</p>

<p>우리는 이미 실패한 <code>block</code> 을 <code>a</code> 에 쌓아놨기 때문에, 이것을 그대로 돌려주려면 <code>() =&gt;</code> 로 감싸서 성공할 수 있도록 해야한다.</p>

<h3 id="async">Async</h3>

<p>타입에 <em>effect</em> 를 명시하는건 무슨일이 일어나는지 알려주니까 정말 좋긴 한데, 코드를 작성하기가 까다롭다. 좀 간단하게 할 수 있는 방법은 없을까?</p>

<pre><code class="language-scala">import scala.async.Async._

def async[T](body: =&gt; T)
  (implicit context: ExecutionContext): Future[T]
  
def await[T](future: Future[T]): T
</code></pre>

<p>여기서 <code>async</code> 는 <code>Future</code> 의 팩토리라 보면 된다. 위에서 본 코드와의 다른점은, 내부에 <code>await</code> 함수를 사용할 수 있다. 얼핏 보면 <code>await</code> 은 블럭킹을 위한 <code>Awaitable</code> 과 비슷하게 보이기도 한다. <code>Future</code> 를 받아 <code>T</code> 를 돌려주니까.</p>

<pre><code class="language-scala">trait Awaitable[T] extends AnyRef {
  abstract def ready(atMost: Duration): Unit
  abstract def result(atMost: Duration): T
}

// usage
Await.result(confirmation, 2 seconds)
</code></pre>

<p>그러나 놀랍게도 <code>await</code> 함수는 블럭되지 않는다. 코드를 보기전에 잠깐 설명서를 좀 보면</p>

<blockquote>
<p><strong>Illegal Uses</strong></p>

<ul>
<li><p>await requires a directly-enclosing async; this means await must not be used inside a closure nested within in an async block, or insdie a nested object, trait, or class</p></li>

<li><p>await must not be used inside an expression passed as an argument to a by name parameter</p></li>

<li><p>await must not be used inside a Boolean short-circuit argument</p></li>

<li><p>return expression are illegal inside an async block</p></li>

<li><p>await should not be used under a <strong>try / catch</strong></p></li>
</ul>
</blockquote>

<p><code>try / catch</code> 구문을 이용할 수 없으므로 <code>Try</code> 모나드를 써야한다. 이제 위에서 봤던 <code>retry</code> 함수를 <code>await</code> 을 이용해서 작성하면</p>

<pre><code class="language-scala">def retry(times: Int)(block =&gt; Future[T]): Future[T] = async {
  val i = 0
  var result: Try[T] = Failure(new Exception(&quot;sorry man!&quot;))
  
  while (i &lt; times &amp;&amp; result.isFailure) {
    result = await { Try(block) }
    i += 1
  }
  
  result.get
}
</code></pre>

<p>코드가 좀 더 이해하기 쉬워졌다. 그리고 내부에서는 <em>mutable state</em> 를 사용할지라도 외부로는 여전히 <em>purely functional</em> 이다.</p>

<p>내친김에 <code>filter</code> 도 구현해 보자.</p>

<pre><code class="language-scala">def async[T](body: =&gt; T)
  (implicit context: ExecutionContext): Future[T]
def await[T](future: Future[T]): T

def filter(p: T =&gt; Boolean): Future[T] = async {
  val x = await { this }
  
  if (!p(x)) throw new NoSuchElementException()
  else x
}
</code></pre>

<p>여기서 예외를 던지는 이유는 <em>empty future</em> 를 예외로 간주하기 때문이다. 앞서 코드에서도 그랬듯이.</p>

<p><code>flatMap</code> 은 어떨까?</p>

<pre><code class="language-scala">def async[T](body: =&gt; T)
  (implicit context: ExecutionContext): Future[T]
def await[T](future: Future[T]): T

def flatMap[S](f: T =&gt; Future[S]): Future[S] =
  async { await { f(await {this}) }}
</code></pre>

<h3 id="promise">Promise</h3>

<p><code>await</code> 없이 <code>filter</code> 를 만들려면 <code>Promise</code> 를 사용할 수 있다.</p>

<pre><code class="language-scala">def filter(pred: T =&gt; Boolean): Future[T] = {
  val p = Promise[T]()
  
  this onComplete {
    case Failure(e) =&gt; p.failure(e)
    case Success(x) =&gt; 
      if (!pred(x)) p.failure(new NoSuchElementException)
      else p.success(x)
  }
  
  p.future
}
</code></pre>

<p><code>Promise</code> 의 정의를 보면</p>

<pre><code class="language-scala">trait Promise[T] {
  def future: Future[T]
  def complete(result: Try[T]): Unit
  def tryComplete(result: Try[T]): Boolean
}

trait Future[T] {
  def onCompleted(f: Try[T] =&gt; Unit): Unit
}
</code></pre>

<p><code>Promise</code> 는 <code>Future</code> 를 담고 있는데, <code>Future.onCompleted</code> 에 등록된 콜백 <code>f: Try[T] =&gt; Unit</code> 은, <code>Promise.complete</code> 에 의해 호출된다.</p>

<p><code>Promise.complete</code> 는 한번만 호출될 수 있다. 상식적으로 생각해봐도 그렇다. 따라서 <code>tryComplete</code> 를 만들어, 이미 완료되으면 <code>false</code> 를 얻어 검사한다.</p>

<p>재미난 예제를 하나 더 보자.</p>

<pre><code class="language-scala">import scala.concurrent.ExecutionContext.Implicits.global

def race[T](left: Future[T], right: Future[T]): Future[T] = {
  val p = Promise[T]()
  
  left  onComplete { p.tryComplete(_) }
  right onComplete { p.tryComplete(_) }
  
  p.future
}
</code></pre>

<p>두 <code>left, right</code> <em>computation</em> 중 먼저 끝나는 연산이 돌려주는 <code>Try[T]</code> 가 <code>p.future.onComplete</code> 의 콜백에 삽입된다.</p>

<p>어떤 리소스를 얻길 원하는데 로컬 캐싱값과 리모트 값 둘 중 먼저 얻어오는 것을 사용하려고 할 때 이런 코드를 작성할 수 있다. <em>HTML5</em> 에도 <em>worker</em>(?) 라고 이렇게 활용할 수 있는 기능이 있는걸로 안다.</p>

<p><code>Promise</code> 에는 몇 가지 함수들이 더 있다.</p>

<pre><code class="language-scala">trait Promise[T] {
  def future: Future[T]
  def complete(result: Try[T]): Unit
  def tryComplete(result: Try[T]): Boolean
  
  // helper method
  def success(value: T): Unit = this.complete(Success(value))
  def failure(t: Throwable): Unit = this.complete(Failure(t))
}
</code></pre>

<p>이제 아까 <code>filter</code> 로 다시 돌아가자.</p>

<pre><code class="language-scala">// async version
def filter(p: T =&gt; Boolean): Future[T] = async {
  val x = await { this }
  
  if (!p(x)) throw new NoSuchElementException()
  else x
}

// promise version
def filter(pred: T =&gt; Boolean): Future[T] = {
  val p = Promise[T]()
  
  this onComplete {
    case Failure(e) =&gt; p.failure(e)
    case Success(x) =&gt; 
      if (!pred(x)) p.failure(new NoSuchElementException)
      else p.success(x)
  }
  
  p.future
}
</code></pre>

<p><code>zip</code> 도 <code>Promise</code> 와 <code>await</code> 이용해 작성해 보자.</p>

<pre><code class="language-scala">// promise version
def zip[S, R](that: Future[S], f: (T, S) =&gt; R): Future[R] = {
  val p = Promise[R]()
  
  this onComplete {
    case Failure(e) =&gt; p.failure(e)
    case Success(x) =&gt; that onComplete {
      case Failure(e) =&gt; p.failure(e)
      case Success(y) =&gt; p.success(f(x, y))
    }
  }
  
  p.future
}

// async version
def zip[S, R](p: Future[S], f: (T, S) =&gt; R): Future[R] = async {
  f(await { this }, await {that })
}
</code></pre>

<p><del>갓 async</del></p>

<p>시퀀스도 <code>await</code> 을 이용해서 구현하면</p>

<pre><code class="language-scala">def sequence[T](fs: List[Future[T]]): Future[List[T]] = async {
  var _fs = fs
  var r = ListBuffer[T]()
  while (_fs != Nil) {
    r += await { _fs.head }
    _fs = _fs.tail
  }
  
  r.result
}
</code></pre>

<p>즉 <code>Future[T]</code> 를 하나씩 <em>async</em> 하게 얻어, 리스트로 돌려준다. 만약 이걸 <code>Promise</code> 로 구현하면</p>

<pre><code class="language-scala">def sequence[T](fs: List[Future[T]]): Future[List[T]] = {
  val successful = Promise[List[T]]()
  successful.success(Nil)
  
  fs.foldRight(successful.future) {
    (f, acc) =&gt; for {x &lt;- f; xs &lt;- acc} yield x :: xs
  }
}
</code></pre>

<p><code>Future[T]</code> 를 누적해서 리스트를 만들어야 하기 때문에 <code>Promise.complete(Nil)</code> 을 세팅해 이것의 <code>Promise.future</code> 를 <code>foldRight</code> 의 초기값으로 사용한다.</p>

<p>그리고 <em>for expression</em> 에서 <code>f: Future[T], acc: Future[List[T]]</code> 다. 따라서 <code>for</code> 구문에서 모나드가 벗겨져 <code>x: T, xs: List[T]</code> 이며 성공적¼로 <code>x</code> 를 가져오면 컨싱한다.</p>

<p>지금까지 <code>Try</code> 와 <code>Future</code> 를 살펴봤다. 다음엔 하나의 값이 아니라 컬렉션을 <em>async</em> 하게 어떻게 처리하나 알아보자.</p>

<pre><code>                  One           Many
                  
Synchronous     T/Try[T]     Iterable[T]
Asynchronous    Future[T]    Observable[T]
</code></pre>

<h3 id="references">References</h3>

<p>(1) <em>Reactive Programming</em> by <strong>Martin Ordersky</strong></p>

<br/>
<br/>
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = '1ambda';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      
      </div>
    </div>

    <div id="navigation">
        <a class="nav nav-prev" href="../reactive-programming-2"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="../reactive-programming-4" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://1ambda.github.io/js/clipboard.min.js"></script>
    <script src="https://1ambda.github.io/js/perfect-scrollbar.min.js"></script>
    <script src="https://1ambda.github.io/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://1ambda.github.io/js/jquery.sticky-kit.min.js"></script>
    <script src="https://1ambda.github.io/js/featherlight.min.js"></script>
    <script src="https://1ambda.github.io/js/html5shiv-printshiv.min.js"></script>
    <script src="https://1ambda.github.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://1ambda.github.io/js/modernizr.custom.71422.js"></script>
    <script src="https://1ambda.github.io/js/learn.js"></script>
    <script src="https://1ambda.github.io/js/hugo-learn.js"></script>
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-52181619-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


  </body>
</html>


